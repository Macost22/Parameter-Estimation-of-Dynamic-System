function [Y,Xf,Af] = NN_LM_K22(X,~,~)
%MYNEURALNETWORKFUNCTION neural network simulation function.
%
% Auto-generated by MATLAB, 22-Apr-2021 01:47:33.
%
% [Y] = myNeuralNetworkFunction(X,~,~) takes these arguments:
%
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = Qx6 matrix, input #1 at timestep ts.
%
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = Qx1 matrix, output #1 at timestep ts.
%
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [6.7155162862109e-07;0.227765751497821;0;0.260905029807448;0;0.401016135895025];
x1_step1.gain = [2.00000134860859;3.78564680696321;2;4.86867054572389;2;7.6089687160829];
x1_step1.ymin = -1;

% Layer 1
b1 = [-1.4392123719297968965;1.8845957600260332399;-1.3201834917625425714;36.253446672310623455;28.475813737864083208;-6.2273226976427329404;29.772841912483947624;-1.8532352329542627345;0.72361523994577636731;-29.658828718456312856;0.84057760294744487961;1.5542547777908390927;-42.001373741142664642;-0.3962528566911880934;6.4820538288513880332;26.7997717195601588;-8.7681194212039912372;-0.90884929283362414498;0.56207897764056868883;6.6863950942874579297];
IW1_1 = [1.6142158493006937281 -0.18972059958167511451 9.1495967258164725422 1.3520688100042035362 0.14170864244296735301 -0.030544051953879412103;-6.4656567159286835178 0.17161991937917428497 -11.680119446419949369 -2.2680427989031262115 -0.13899803185354014934 0.055314989068809349015;5.0733656373563604802 -0.43719506059963608724 -1.5938771539645952835 1.0038655684798305501 0.0063812649801511037162 -0.14244577473414202218;-104.5793273841577502 3.2028907341063614922 -148.58324317676792248 -31.532479305722059593 -3.3297086277786398512 0.59665835081792895078;-45.130090210571808029 2.1511685563513003316 -156.03723023807273762 -23.75363296328889362 -1.7543616294608304074 0.38858201232447486806;0.88823539946759211272 -0.59596731860691964933 44.016818544919658507 5.175419621866525155 0.31351604161979412799 -0.06337099937065607258;-96.065800797716704551 -0.82695567230637545553 -108.58409547856392408 -22.900879160401743206 2.8331171929041216728 0.054351749263986039173;4.0521106110003559664 -0.17350201949818755409 7.4163899493564953147 1.4724830822996846091 0.13235925760425001907 -0.031780663505613489239;3.2737849406532810725 0.31041415972898811493 -8.4826880863002571687 -0.74632441368612134625 -0.1397202900410005888 0.017563419090574888121;28.878236910711390095 -0.12001467757409518822 183.48812522840574957 22.7693376254141846 -0.99909643274402581969 -0.2228512874963574919;-4.6871551119275203234 0.35571281269722754281 3.4173281460473599047 -0.42705472646017816896 -0.024326019921642010047 0.028614765619887700537;-2.5691216341963105663 0.18505313600063375001 -11.627769628035736105 -1.7491479574782804463 -0.15509785603377870822 0.04303844187046299008;158.96096488159881233 -2.9573359327478794256 132.99979578754684439 36.716608707752264706 2.6893648699386458745 -0.64681456457999531029;-1.9039378054576401311 0.4002394718852309019 0.26233407511616296803 -0.59550062589647978495 -0.011684595218116959267 0.051689750562630067121;10.144890252200603697 0.58023060914631496843 -55.242989015047854195 -4.9035955066544616443 -0.41857781786081676989 0.066556694250129180834;-53.227595385686974794 -0.82756436183745274437 -134.78869651562524723 -20.080708753045485082 2.357669185187763361 0.070894644473163348497;16.684808523690112025 20.933329832170016971 26.479887458765329455 -7.9267215770080081683 -6.3142680990723674128 -4.4710312906468772098;-4.6640140597483981111 -0.26409525160948543743 9.1883890066185216483 0.61004350498078685483 0.15508480301711702332 -0.028107456525989470142;1.8253443034885772356 -0.44988930090341827661 -0.040933041001811623638 0.65826162469024451784 0.01163598753745391165 -0.063431804413144610155;-12.732129060894440187 0.66470417627391009674 -37.051303582637409306 -6.0438905481969076305 -0.23529792776012370403 0.067447461085436033468];

% Layer 2
b2 = 1.32260691215875692;
LW2_1 = [-106.15942997487209709 27.719513857922347455 3.0665698213253920201 -60.359458741789701719 51.386144038788728494 79.691582773401478335 -38.327325236925496199 45.57239204521474818 -24.870776027837496969 53.952941558049509752 -1.5328111604919243405 -77.207551058081875794 -39.833680870617108383 37.31598517269448223 37.464233750292613934 65.189143025069355986 -0.023832539384409923838 -12.809588442167363809 31.787950185666772995 38.593953733755462565];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 7.9092362028324;
y1_step1.xoffset = 0.747131082103254;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
    X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},1); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS
    
    % Input 1
    X{1,ts} = X{1,ts}';
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = repmat(b2,1,Q) + LW2_1*a1;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a2,y1_step1);
    Y{1,ts} = Y{1,ts}';
end

% Final Delay States
Xf = cell(1,0);
Af = cell(2,0);

% Format Output Arguments
if ~isCellX
    Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
y = bsxfun(@minus,x,settings.xoffset);
y = bsxfun(@times,y,settings.gain);
y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
x = bsxfun(@minus,y,settings.ymin);
x = bsxfun(@rdivide,x,settings.gain);
x = bsxfun(@plus,x,settings.xoffset);
end
